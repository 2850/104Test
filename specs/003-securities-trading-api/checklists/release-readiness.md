# 需求品質檢核表：證券交易 API - 正式發布就緒稽核

**目的**: 正式發布就緒稽核 - 驗證需求規格的完整性、清晰度、一致性、可測試性與憲章合規性  
**建立日期**: 2026-02-02  
**焦點領域**: BDD 情境可執行性、憲章合規性（原則 II、V、VI）、需求品質全面驗證  
**深度等級**: 正式發布就緒 - 實作啟動前的全面審查

---

## BDD 情境完整性與可執行性（憲章原則 II）

- [ ] CHK001 - 所有使用者故事的 Given-When-Then 情境是否符合 BDD 格式規範，能夠直接轉換為可執行的驗收測試？[清晰度, 可測試性, Spec §使用者情境]
- [ ] CHK002 - 使用者故事 1（股票代號查詢）的四個驗收情境是否涵蓋主要流程、錯誤流程、模糊查詢與格式驗證？是否遺漏任何關鍵情境？[涵蓋率, Spec §使用者故事 1]
- [ ] CHK003 - 使用者故事 2（查詢即時價格）的四個驗收情境是否包含正常流程、收盤情境、API 失敗與停牌情境？是否遺漏快取或限流情境？[涵蓋率, 邊界案例, Spec §使用者故事 2]
- [ ] CHK004 - 使用者故事 3（建立委託單）的五個驗收情境是否涵蓋價格驗證、數量驗證、欄位驗證與成功建立流程？是否遺漏並發建立或重複提交情境？[涵蓋率, 邊界案例, Spec §使用者故事 3]
- [ ] CHK005 - 使用者故事 4（查詢委託單）的三個驗收情境是否足夠？是否需要補充查詢多筆委託單或分頁情境？[涵蓋率, Spec §使用者故事 4]
- [ ] CHK006 - 每個 Given-When-Then 情境的前置條件（Given）是否明確可重現？測試執行者能否根據描述準備測試資料？[可測試性, 清晰度, Spec §驗收情境]
- [ ] CHK007 - 每個 Given-When-Then 情境的預期結果（Then）是否可客觀驗證？是否包含可量測的成功標準？[可量測性, Spec §驗收情境]
- [ ] CHK008 - 邊界案例章節列出的七個情境是否都有對應的需求定義或驗收情境？或僅為待釐清問題？[完整性, 一致性, Spec §邊界案例]
- [ ] CHK009 - 是否明確定義每個使用者故事的「獨立測試」標準，確保測試可在無其他功能依賴下執行？[可測試性, Spec §獨立測試]
- [ ] CHK010 - 是否所有需求（FR-001 至 FR-024）都能追溯至少一個 Given-When-Then 驗收情境？[可追溯性, 涵蓋率, Spec §需求]

## 憲章原則 V：繁體中文文件一致性

- [ ] CHK011 - 規格書所有面向使用者的內容（使用者故事、驗收情境、錯誤訊息範例）是否全部使用繁體中文撰寫？[憲章合規性, Spec §全文]
- [ ] CHK012 - 錯誤訊息範例（如「股票代號不存在」、「價格超出漲跌停範圍」）是否使用使用者友善的繁體中文表達，無技術術語？[清晰度, 憲章合規性, Spec §驗收情境, FR-022]
- [ ] CHK013 - API 回應訊息的語言要求是否明確定義？是否要求所有錯誤訊息、狀態訊息都必須使用繁體中文？[缺口, 憲章合規性]
- [ ] CHK014 - 實體名稱（Stock、Order）使用英文，但其屬性描述（如「委託單編號」、「買賣別」）使用繁體中文，這種混用是否符合憲章要求？是否需要統一？[一致性, 憲章合規性, Spec §關鍵實體]

## 憲章原則 VI：MVP 範圍邊界清晰度

- [ ] CHK015 - 「明確排除的功能」章節是否完整列出所有第一版 MVP 不實作的功能，防止範圍蔓延？[完整性, 憲章合規性, Spec §明確排除的功能]
- [ ] CHK016 - 排除的功能（如融資融券、IOC/FOK、零股交易、使用者認證）是否與規格書其他章節一致？是否有其他章節暗示這些功能需要實作？[一致性, 衝突檢查, Spec §明確排除的功能]
- [ ] CHK017 - 假設章節提到「委託單建立後的初始狀態為已委託，但本階段不處理後續狀態變更」，這是否與 MVP 排除功能一致？是否需要更明確定義？[一致性, 清晰度, Spec §假設, FR-016]
- [ ] CHK018 - MVP 範圍是否包含足夠的價值交付，讓使用者能完成完整的核心流程（查詢股票 → 查詢價格 → 建立委託 → 查詢委託）？[MVP 原則, 憲章合規性, Spec §使用者故事]
- [ ] CHK019 - 明確排除的「會員機制和使用者認證」、「API 安全機制」是否會影響 MVP 的可用性或安全性？是否需要最低限度的安全措施？[風險評估, 缺口, Spec §明確排除的功能]

## 需求完整性

- [ ] CHK020 - FR-001 至 FR-003（股票資料管理）是否完整定義資料來源、載入時機、更新頻率？台灣證交所股票清單如何取得與維護？[完整性, 缺口, Spec §FR-001 至 FR-003]
- [ ] CHK021 - FR-006 提到使用「FinMind API 或類似服務」，是否明確定義 API 選擇標準、備援方案、服務條款影響？[清晰度, Spec §FR-006, §依賴性]
- [ ] CHK022 - FR-007 列出的完整即時資訊欄位是否涵蓋所有必要資訊？是否遺漏「今日漲跌幅百分比」、「振幅」等常見指標？[完整性, Spec §FR-007]
- [ ] CHK023 - FR-008 定義的重試機制（逾時 5 秒、重試兩次、指數退避）是否也適用於其他外部 API 呼叫（如股票清單載入）？[一致性, Spec §FR-008]
- [ ] CHK024 - FR-009 至 FR-017（委託單建立）是否定義委託單編號生成規則的具體格式與唯一性保證機制？[清晰度, Spec §FR-015, SC-008]
- [ ] CHK025 - FR-012 要求驗證「價格在漲跌停範圍內」，但如何取得漲跌停價格？是否依賴 FR-007 的即時資訊查詢？依賴關係是否明確？[完整性, 依賴性, Spec §FR-012]
- [ ] CHK026 - FR-013 要求「整股交易為 1000 股整數倍」，但驗收情境中未明確測試非整數倍的拒絕情境，是否需要補充？[涵蓋率, Spec §FR-013, §使用者故事 3]
- [ ] CHK027 - FR-018 至 FR-020（委託單查詢）是否支援查詢多筆委託單？是否提供篩選或分頁功能？或僅限單筆查詢？[清晰度, 範圍界定, Spec §FR-018 至 FR-020]
- [ ] CHK028 - FR-021 至 FR-024（錯誤處理）是否涵蓋所有可能的錯誤類型？是否遺漏資料庫連線失敗、ORM 異常等技術錯誤？[完整性, Spec §FR-021 至 FR-024]
- [ ] CHK029 - FR-024 定義速率限制為「每秒 10 次請求」，是否所有 API 端點共用此限制？或各端點獨立計算？[清晰度, Spec §FR-024]
- [ ] CHK030 - 是否定義 API 的版本控制策略，確保未來需求變更時的向後相容性？[缺口, 長期維護性]

## 需求清晰度與可量測性

- [ ] CHK031 - SC-001 定義「1 秒內完成查詢」，是否包含網路延遲時間？量測起點與終點是否明確（從用戶端發起到收到回應）？[清晰度, 可量測性, Spec §SC-001]
- [ ] CHK032 - SC-002 定義「3 秒內完成查詢（包含外部 API 時間）」，若外部 API 單次逾時 5 秒且重試兩次，最壞情況可能達 15 秒，這與 SC-002 的 3 秒要求是否衝突？[衝突檢查, Spec §SC-002, FR-008]
- [ ] CHK033 - SC-004 要求「100% 攔截超出漲跌停範圍的價格」，是否定義邊界值（等於漲跌停價）的處理方式？假設章節提到「可以等於」，是否與此成功標準一致？[一致性, Spec §SC-004, §假設]
- [ ] CHK034 - SC-005 要求「明確錯誤訊息，使用者無需技術知識」，是否提供錯誤訊息範例清單或撰寫指引，確保開發團隊一致理解？[清晰度, Spec §SC-005]
- [ ] CHK035 - SC-007 定義「90% 使用者第一次成功完成流程」，如何量測？是否需要埋點或日誌記錄機制？[可量測性, 缺口, Spec §SC-007]
- [ ] CHK036 - 「即時資訊」的「即時」定義是否明確？資料延遲容忍度為何（如 1 秒內、5 秒內）？[清晰度, Spec §FR-004, FR-007]
- [ ] CHK037 - 「使用者友善的錯誤訊息」是否有具體定義或範例？何謂「技術細節」應被隱藏？[清晰度, Spec §FR-022]
- [ ] CHK038 - 「整股交易」和「零股交易」的差異是否在規格中明確說明，確保開發團隊理解為何僅支援整股？[清晰度, Spec §FR-013, §明確排除的功能]

## 需求一致性

- [ ] CHK039 - FR-005 要求「查詢即時資訊前驗證股票代號」，但使用者故事 2 的驗收情境 1 假設「使用者已確認代號有效」，這兩者是否暗示不同的流程？系統會自動驗證還是使用者需先查詢？[一致性, Spec §FR-005, §使用者故事 2]
- [ ] CHK040 - 假設章節與邊界案例章節是否一致？如假設「價格可以等於漲跌停價」，但邊界案例詢問「等於漲跌停價是否允許」，這是否為已解決的問題？[一致性, Spec §假設, §邊界案例]
- [ ] CHK041 - Clarifications 章節提到「單一狀態『已委託』」，但 FR-016 要求儲存「委託狀態」，是否暗示未來會有狀態變更？需求是否明確此為固定值？[一致性, Spec §Clarifications, FR-016]
- [ ] CHK042 - 依賴性章節提到「ORM 框架」和「ACID 交易特性」，但功能需求中未定義交易邊界或併發控制策略，是否需要補充？[完整性, Spec §依賴性, §需求]
- [ ] CHK043 - 使用者故事的優先級（P1 至 P4）與功能需求的編號（FR-001 至 FR-024）是否有對應關係？高優先級故事的需求是否優先實作？[一致性, 可追溯性, Spec §使用者故事, §需求]

## 邊界案例與異常流程涵蓋

- [ ] CHK044 - 邊界案例提到「非交易時段」行為，FR-007 是否明確定義回傳「最後交易資料 + 時間戳記」？或此為未定義行為？[完整性, Spec §邊界案例, FR-007]
- [ ] CHK045 - 邊界案例定義速率限制「每秒 10 次請求」並回傳 HTTP 429，但 FR-024 僅提到「重試建議時間」，是否需要定義 Retry-After header 的計算邏輯？[清晰度, Spec §邊界案例, FR-024]
- [ ] CHK046 - 邊界案例提到「外部 API 回應過慢」的重試策略已在 FR-008 定義，但其他外部呼叫（如股票清單載入）是否套用相同策略？[一致性, Spec §邊界案例, FR-008]
- [ ] CHK047 - 邊界案例詢問「股票暫停交易時委託單建立如何回應」，是否已在需求中定義？或此為待解決問題？[缺口, Spec §邊界案例]
- [ ] CHK048 - 邊界案例詢問「委託單數量為 0 或負數」的驗證，FR-014 要求「驗證必填欄位」，但是否涵蓋數值範圍驗證？[完整性, Spec §邊界案例, FR-014]
- [ ] CHK049 - 邊界案例提到「同時建立委託單的唯一性保證」，FR-015 要求「產生唯一編號」，但併發控制機制是否明確定義（如資料庫唯一索引、分散式鎖）？[清晰度, Spec §邊界案例, FR-015]
- [ ] CHK050 - 是否定義資料庫連線失敗、ORM 異常、MS SQL Server 不可用等基礎設施失敗的錯誤處理與使用者回饋？[缺口, 異常流程]
- [ ] CHK051 - 是否定義部分資料載入失敗的行為（如股票清單僅載入 50%）？系統如何處理不完整資料？[缺口, 異常流程]

## 非功能需求完整性

- [ ] CHK052 - 效能需求（SC-001 至 SC-003 的回應時間）是否定義在何種負載條件下量測（如單一使用者、100 並發使用者）？[清晰度, 可量測性, Spec §成功標準]
- [ ] CHK053 - 是否定義系統的併發處理能力？每秒可處理多少筆委託單建立請求？[缺口, 效能需求]
- [ ] CHK054 - 是否定義資料一致性要求？如委託單建立是否需要強一致性（立即可查詢）或可接受最終一致性？[缺口, 非功能需求]
- [ ] CHK055 - 是否定義可用性要求？系統正常運行時間目標（如 99.9% uptime）為何？[缺口, 非功能需求]
- [ ] CHK056 - 是否定義安全性基線要求？雖然 MVP 排除認證機制，但是否需要防範 SQL Injection、XSS 等基本攻擊？[缺口, 安全性, Spec §明確排除的功能]
- [ ] CHK057 - 是否定義資料保存期限與備份策略？委託單資料保存多久？是否需要定期備份？[缺口, 非功能需求]
- [ ] CHK058 - 是否定義日誌記錄要求的詳細程度？FR-023 要求記錄「API 呼叫錯誤」，但日誌應包含哪些欄位（時間戳記、請求 ID、錯誤堆疊）？[清晰度, Spec §FR-023]
- [ ] CHK059 - 是否定義監控與告警需求？雖然 MVP 排除「監控與效能指標追蹤」，但基本的錯誤告警是否需要？[缺口, 衝突檢查, Spec §明確排除的功能]

## 依賴性與假設驗證

- [ ] CHK060 - 假設「台灣證交所介面在交易時段內穩定存取，回應時間 1-2 秒」，是否已驗證？是否有備援計畫？[假設驗證, 風險, Spec §假設]
- [ ] CHK061 - 假設「使用者已了解股票交易基本概念」，是否意味系統可省略某些驗證或提示？這與使用者友善錯誤訊息的要求是否衝突？[假設驗證, Spec §假設]
- [ ] CHK062 - 依賴性提到「FinMind API 速率限制和服務條款」，是否已確認這些限制不會影響 MVP 功能？是否需要在需求中定義因應策略？[依賴性驗證, 風險, Spec §依賴性]
- [ ] CHK063 - 依賴性提到「MS SQL Server 和 ORM 框架」，是否已明確選擇特定的 ORM（如 Entity Framework）？技術選型是否會影響需求定義？[依賴性驗證, Spec §依賴性]
- [ ] CHK064 - Clarifications 章節回答的五個問題是否已完整整合回功能需求？或僅為備註性質？[一致性, 可追溯性, Spec §Clarifications]
- [ ] CHK065 - 是否存在其他未記錄的依賴性（如網路基礎設施、時間同步服務）？[缺口, 依賴性]

## 可追溯性與文件結構

- [ ] CHK066 - 每個功能需求（FR-001 至 FR-024）是否都能追溯至少一個使用者故事或驗收情境？[可追溯性, 需求覆蓋]
- [ ] CHK067 - 每個成功標準（SC-001 至 SC-008）是否都能追溯至具體的功能需求？[可追溯性, 驗收標準]
- [ ] CHK068 - 關鍵實體（Stock、Order）的屬性定義是否與功能需求一致？是否有需求提到的欄位未在實體定義中出現？[一致性, Spec §關鍵實體, §需求]
- [ ] CHK069 - 使用者故事的「為何此優先級」說明是否提供充分理由？是否有助於團隊理解實作順序？[清晰度, Spec §使用者故事]
- [ ] CHK070 - 規格書是否包含所有必要章節（使用者情境、需求、成功標準、假設、依賴性）？是否遺漏風險評估或技術限制章節？[完整性, 文件結構]

## 實作可行性與技術風險

- [ ] CHK071 - FR-015 要求「產生唯一委託單編號」，但未定義編號格式。是否需要包含日期、序號、校驗碼等元素？格式是否需要人類可讀？[清晰度, Spec §FR-015]
- [ ] CHK072 - FR-008 的重試機制「指數退避 1 秒、2 秒」加上初始請求 5 秒逾時，最壞情況總耗時達 18 秒（5+1+5+2+5），這與 SC-002 的 3 秒目標明顯衝突，如何調和？[衝突檢查, 實作可行性, Spec §FR-008, SC-002]
- [ ] CHK073 - 股票清單資料「預先載入」（FR-001）是否定義載入時機？系統啟動時載入？定期更新？[清晰度, Spec §FR-001]
- [ ] CHK074 - FR-003 提到「關鍵字模糊查詢」，是否定義查詢演算法或效能要求？大量股票清單的模糊查詢是否會影響回應時間？[清晰度, 效能風險, Spec §FR-003]
- [ ] CHK075 - MS SQL Server 的 ACID 特性如何套用至委託單建立？是否需要定義交易隔離等級，防止髒讀或幻讀？[缺口, 技術細節, Spec §依賴性]
- [ ] CHK076 - 速率限制「每個客戶端 IP」（FR-024）在分散式部署或使用代理伺服器的情況下如何實作？是否會誤判？[技術風險, Spec §FR-024]

## 使用者體驗與可用性

- [ ] CHK077 - 使用者故事是否涵蓋完整的使用者旅程？從進入系統到完成委託單建立並查詢結果，是否有斷點或不連貫之處？[完整性, UX, Spec §使用者故事]
- [ ] CHK078 - 錯誤訊息範例（如「股票代號不存在」、「價格超出漲跌停範圍」）是否提供使用者明確的下一步行動指引？[清晰度, UX, Spec §驗收情境]
- [ ] CHK079 - 查詢結果的資料呈現格式是否定義？如五檔買賣資訊如何結構化回傳（陣列、物件）？[缺口, API 設計, Spec §FR-007]
- [ ] CHK080 - 是否定義使用者在等待外部 API 回應期間（可能長達 3 秒）的回饋機制（如載入指示器）？[缺口, UX]

---

## 檢核表統計

- **總項目數**: 80
- **可追溯性引用比例**: 86% (69/80 項目包含 Spec 引用或缺口標記)
- **焦點領域分佈**:
  - BDD 合規性: 10 項
  - 憲章合規性（原則 V、VI）: 9 項
  - 需求完整性: 11 項
  - 需求清晰度與可量測性: 8 項
  - 需求一致性: 5 項
  - 邊界案例與異常流程: 8 項
  - 非功能需求: 8 項
  - 依賴性與假設驗證: 6 項
  - 可追溯性與文件結構: 5 項
  - 實作可行性與技術風險: 6 項
  - 使用者體驗與可用性: 4 項

## 關鍵發現總結

### 高優先級問題

1. **效能需求衝突** [CHK032, CHK072]: SC-002 要求 3 秒內完成查詢，但 FR-008 的重試機制在最壞情況下需要 18 秒（5 秒逾時 × 3 次嘗試 + 1+2 秒退避），存在明顯不一致。需要調整逾時設定或成功標準。

2. **並發控制缺口** [CHK024, CHK049]: 委託單編號唯一性保證機制未明確定義。在高併發情境下，需要明確的技術策略（如資料庫唯一索引、分散式 ID 生成）。

3. **依賴性風險** [CHK021, CHK062]: FinMind API 或類似服務的可用性、速率限制、服務條款可能影響 MVP 可用性，缺乏備援計畫。

### 中優先級問題

4. **BDD 情境涵蓋率** [CHK003, CHK004, CHK026]: 部分驗收情境可能遺漏關鍵場景，如快取策略、重複提交、非整數倍股數拒絕等。

5. **非功能需求缺口** [CHK053-CHK059]: 併發處理能力、資料一致性、可用性目標、基本安全措施、資料保存策略等非功能需求未明確定義。

6. **邊界案例待釐清** [CHK044, CHK047]: 部分邊界案例（如非交易時段行為、停牌股票委託）在需求中未明確定義。

### 憲章合規性

7. **繁體中文一致性** [CHK013]: 需要明確定義 API 回應訊息的語言要求，確保所有使用者可見訊息使用繁體中文。

8. **MVP 範圍清晰度** [CHK019]: 排除的安全機制（認證、授權）可能影響 MVP 的實際可用性，需評估最低安全基線。

9. **BDD 可執行性** [CHK001, CHK006, CHK007]: 需驗證所有 Given-When-Then 情境能否直接轉換為自動化測試，前置條件是否可重現，預期結果是否可客觀驗證。

### 建議行動

1. **立即處理**: CHK032（效能衝突）、CHK049（併發控制）、CHK062（依賴性風險）
2. **實作前釐清**: CHK013（API 語言要求）、CHK019（安全基線）、CHK044/CHK047（邊界案例）
3. **補充文件**: CHK053-CHK059（非功能需求）、CHK066-CHK067（可追溯性）
4. **BDD 驗證**: CHK001-CHK010（確保所有情境可執行且涵蓋完整）
